<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive - Suivi des Tremblements de Terre</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-omnivore@0.3.3/leaflet-omnivore.min.js"></script>
    <script src="Haouz.geojson"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .containeer { 
        display: grid; 
        grid-template-columns: repeat(2, 1fr); 
        grid-template-rows: repeat(2, 1fr); 
        gap: 20px; 
        row-gap: 5px;
        justify-items: center; 
        align-items: center; 
        position: relative;
        left: 400px;
        }
         .text-box {
            --r: 25px;
            --s: 40px; 
            padding: 20px;
            width: 300px;
            background-color: #fff;
            border-radius: var(--r);
            color: #333;
            font-family: Arial, sans-serif;
            margin: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .top-right {
            --_m:/calc(2*var(--r)) calc(2*var(--r))
            radial-gradient(#000 70%,#0000 72%) no-repeat;
            mask:
    right calc(var(--s) + var(--r)) top 0 var(--_m),
    right calc(var(--s) + var(--r)) var(--_m),
    radial-gradient(var(--s) at 100% 0,#0000 99%,#000 101%) 
     calc(-1*var(--r)) var(--r) no-repeat,
    conic-gradient(at calc(100% - var(--s) - 2*var(--r)) calc(var(--s) + 2*var(--r)),
     #0000 25%,#000 0);
}
        .top-left {
            --_m:/calc(2*var(--r)) calc(2*var(--r))
            radial-gradient(#000 70%,#0000 72%) no-repeat;
            mask:
    calc(var(--s) + var(--r)) 0 var(--_m),
    0 calc(var(--s) + var(--r)) var(--_m),
    radial-gradient(var(--s) at 0 0,#0000 99%,#000 101%) 
     var(--r) var(--r) no-repeat,
    conic-gradient(at calc(var(--s) + 2*var(--r)) calc(var(--s) + 2*var(--r)),
     #000 75%,#0000 0);
}
        .bottom-left {
            --_m:/calc(2*var(--r)) calc(2*var(--r))
            radial-gradient(#000 70%,#0000 72%) no-repeat;
            mask:
    calc(var(--s) + var(--r)) bottom var(--_m),
    bottom calc(var(--s) + var(--r)) left 0 var(--_m),
    radial-gradient(var(--s) at 0 100%,#0000 99%,#000 101%) 
     var(--r) calc(-1*var(--r)) no-repeat,
    conic-gradient(from 180deg at calc(var(--s) + 2*var(--r)) calc(100% - var(--s) - 2*var(--r)),
     #0000 25%,#000 0);
}
        .bottom-right {
            --_m:/calc(2*var(--r)) calc(2*var(--r))
            radial-gradient(#000 70%,#0000 72%) no-repeat;
            mask:
    right 0 bottom calc(var(--s) + var(--r)) var(--_m),
    right calc(var(--s) + var(--r)) bottom 0 var(--_m),
    radial-gradient(var(--s) at 100% 100%,#0000 99%,#000 101%) 
     calc(-1*var(--r)) calc(-1*var(--r)) no-repeat,
    conic-gradient(from 90deg at calc(100% - var(--s) - 2*var(--r)) calc(100% - var(--s) - 2*var(--r)),
     #0000 25%,#000 0);
}
        #map {
            width: 100%;
            height: 100%;
        }
        .control-panel {
            background-color: rgba(255, 255, 255, 0.7);
            color: rgb(0, 0, 0);
            width: 250px;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            height: 100vh;
        }
        .control-panel h2 {
            margin: 0;
            font-size: 18px;
        }
        .control-panel button {
            background-color: #a85a00;
            border: none;
            color: white;
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
        }
        .title {
    position: relative; 
    left: 60px; 
}
.credit {
            font-size: 14px;
            color: #333;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 8px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-family: 'Arial', sans-serif;
        }
        .control-panel button:hover {
            background-color: #005e72;
        }
        .leaflet-control-layers {
            background-color: rgba(255, 255, 255, 0.9) !important;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        @media screen and (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .control-panel {
                width: 100%;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <h2>Panneau de contrôle</h2>
            <button onclick="toggleLayer(); restoreMap()">Province du AL HAOUZ</button>
            <button onclick="toggleImagery(); restoreMap()">Basculer l'imagerie</button>
            <button onclick="resetView(); restoreMap()">Réinitialiser la vue</button>
            <button onclick="showInfo()">Information statistiques</button> 
        </div>
        <div id="map"></div>
        <div id="info" style="display: none;"> 
            <div class="containeer">
                <div class="text-box bottom-right">
                    <h2> &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;Type de logement</h2>
                    <p><canvas id="housingChart" width="200" height="200"></canvas></p>
                </div>
                <div class="text-box bottom-left">
                    <h2>  &nbsp;&nbsp;Ancienneté du logement </h2>
                    <p><canvas id="age" width="200" height="200"></canvas></p>
                </div>
                <div class="text-box top-right">
                    <h2>Matériaux <br>de construction des murs </h2>
                    <p><canvas id="mur" width="200" height="200"></canvas></p>
                </div>
                <div class="text-box top-left">
                    <h2 class="title">Matériaux de<br> construction du toit </h2>
                    <p><canvas id="secondChart" width="200" height="200"></canvas></canvas></p>
                </div>
            </div>  
            <div class="credit">
                <p>Crédit des données : Haut-Commissariat au Plan (HCP)</p>
            </div>           
        </div>
    </div>
    <script>
        var map = L.map('map').setView([31.337, -7.874], 10); 
        var arcgisLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; <a href="https://www.esri.com/en-us/home">Esri</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var openStreetMapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        });

        var geojsonLayer = L.geoJSON(Haouz, {
            style: function (feature) {
                return {
                    color: "#ff7800", 
                    weight: 5,
                    opacity: 0.65
                };
            }
        }).addTo(map);

        var baseMaps = {
            "ArcGIS Imagery": arcgisLayer,
            "OpenStreetMap": openStreetMapLayer
        };
        var overlayMaps = {
            "Province AL HAOUZ": geojsonLayer
        };

        L.control.layers(baseMaps, overlayMaps).addTo(map);

        function showInfo() {
            document.getElementById('map').style.display = 'none';
            document.getElementById('info').style.display = 'block';
        }

        function restoreMap() {
            document.getElementById('map').style.display = 'block';
            document.getElementById('info').style.display = 'none';
        }

        function toggleLayer() {
            if (map.hasLayer(geojsonLayer)) {
                map.removeLayer(geojsonLayer);
            } else {
                geojsonLayer.addTo(map);
            }
        }

        function toggleImagery() {
            if (map.hasLayer(arcgisLayer)) {
                map.removeLayer(arcgisLayer);
                openStreetMapLayer.addTo(map);
            } else {
                map.removeLayer(openStreetMapLayer);
                arcgisLayer.addTo(map);
            }
        }

        function resetView() {
            map.setView([31.337, -7.874], 10);
        }
        const ctx = document.getElementById('housingChart').getContext('2d');
        const data = {
            labels: [
                'Villa',
                'Appartement',
                'Maison Marocaine',
                'Habitat Sommaire',
                'Logement Rural',
                'Autre'
            ],
            datasets: [{
                data: [0.9, 0.5, 38.8, 0.4, 58.9, 0.5],
                backgroundColor: [
                    '#4e73df', 
                    '#1cc88a', 
                    '#36b9cc', 
                    '#f6c23e', 
                    '#e74a3b', 
                    '#858796'
                ],
                hoverBackgroundColor: [
                    '#2e59d9',
                    '#17a673',
                    '#2c9faf',
                    '#d4b12f',
                    '#c72d2c',
                    '#6c757d'
                ]
            }]
        };
        const options = {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                        }
                    }
                }
            }
        };
        new Chart(ctx, {
            type: 'bar',
            data: data,
            options: options
        });
        const ctx2 = document.getElementById('secondChart').getContext('2d');
const data2 = {
    labels: [
        'Dalle',
        'Planches de bois et tuiles',
        'Tole en ciment et tole en étain',
        'Bois récupéré,Bambou ou Herbe recouverts de terre',
        'Etain,Plastique et autres matériaux récupérés',
        'Autre'
    ],
    datasets: [{
        data: [36.5,4.2, 0.3, 58.7,0.2,36.5],
        backgroundColor: [
            '#ff6384',
            '#36a2eb',
            '#cc65fe',
            '#ffce56',
            '#4bc0c0'
        ]
    }]
};
const options2 = {
    responsive: true,
    plugins: {
        legend: {
            position: 'top',
        },
        tooltip: {
            callbacks: {
                label: function(tooltipItem) {
                    return tooltipItem.label + ': ' + tooltipItem.raw;
                }
            }
        }
    }
};
new Chart(ctx2, {
    type: 'doughnut', 
    data: data2,
    options: options2
});
        const ctx3 = document.getElementById('age').getContext('2d');
        const data3 = {
            labels: [
                'Moins de 10 ans',
                '10-19 ans',
                '20-49 ans',
                '50 ans et plus'
            ],
            datasets: [{
                data: [23.1, 18.1, 24.3, 34.5],
                backgroundColor: [
                    '#4e73df', 
                    '#1cc88a', 
                    '#36b9cc', 
                    '#f6c23e', 
                    '#e74a3b', 
                    '#858796'
                ],
                hoverBackgroundColor: [
                    '#2e59d9',
                    '#17a673',
                    '#2c9faf',
                    '#d4b12f',
                    '#c72d2c',
                    '#6c757d'
                ]
            }]
        };
        const optionss = {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                        }
                    }
                }
            }
        };
        new Chart(ctx3, {
            type: 'doughnut',
            data: data3,
            options: optionss
        });
        const ctx4 = document.getElementById('mur').getContext('2d');
        const data4 = {
            labels: [
                'Béton armé,Brisques en terre et cuite parpaings',
                'Pierres scellées avec du moetier',
                'Planches de bois',
                'Pierres scellées avec de la terre',
                'Pisé et Briques de terre crue',
                'Bois récupéré,Etain,Herbe et Bmbou',
                'Autres'
            ],
            datasets: [{
                data: [36.6, 4.6, 0.5, 16.6,41.5,0.2,0],
                backgroundColor: [
                    '#4e73df', 
                    '#1cc88a', 
                    '#36b9cc', 
                    '#f6c23e', 
                    '#e74a3b', 
                    '#858796'
                ],
                hoverBackgroundColor: [
                    '#2e59d9',
                    '#17a673',
                    '#2c9faf',
                    '#d4b12f',
                    '#c72d2c',
                    '#6c757d'
                ]
            }]
        };
        const optionsss = {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                        }
                    }
                }
            }
        };
        new Chart(ctx4, {
            type: 'doughnut',
            data: data4,
            options: optionsss
        });
    </script>
</body>
</html>
